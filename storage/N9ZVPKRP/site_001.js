function fixWebKitInheritanceBug(a){Prototype.Browser.OldWebKit&&(a.prototype.constructor=a)}function $$S(){var a=$A(arguments),b=a.shift();return Selector.findChildElements(b,a)}function $FE(a,b){if("string"==typeof a&&"string"==typeof b){var c=document.forms[a]||$$("FORM#"+a)[0],d=c.elements[b];return c&&d?d:null}}function createCSS(a,b){var c=navigator.userAgent.toLowerCase(),d=/msie/.test(c)&&!/opera/.test(c)&&/win/.test(c),e=document.createElement("style");if(e.setAttribute("type","text/css"),e.setAttribute("media","screen"),d||e.appendChild(document.createTextNode(a+" {"+b+"}")),document.getElementsByTagName("head")[0].appendChild(e),d&&document.styleSheets&&document.styleSheets.length>0){var f=document.styleSheets[document.styleSheets.length-1];"object"==typeof f.addRule&&f.addRule(a,b)}}j$("document").ready(function(){disqus_config&&j$("#article-nav").find(".in-page").append("<li><a href='#comments'>Comments</a></li>")}),Prototype.Browser.IE6||(Prototype.Browser.IE6=function(){return/msie 6/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)&&/win/i.test(navigator.userAgent)}()),Prototype.Browser.OldWebKit||(Prototype.Browser.OldWebKit=function(){var a=navigator.userAgent.match(/AppleWebKit\/(\d+)/);return a&&2==a.length?parseInt(a[1])<=419:!1}()),Element.addMethods({scrollDiv:function(a,b,c){a=$(a),a.scrollLeft=b,a.scrollTop=c},shiftAttribute:function(a,b,c){return a=$(a),a[b]=a[c],a},getDimensions:function(a){a=$(a);var b=$(a).getStyle("display");if("none"!=b&&null!=b)return{width:a.offsetWidth,height:a.offsetHeight};var c=a.style,d=c.visibility,e=c.position,f=c.display;c.visibility="hidden",c.position="absolute",c.display="block";var g=a.clientHeight,h=a.clientWidth;if(c.width.empty()){var i=a.ancestors().find(function(a){return a.clientWidth>0},this);a.setStyle({width:i.clientWidth-parseInt(a.getStyle("padding-left"))+parseInt(a.getStyle("padding-right"))+"px"}),g=a.clientHeight-(parseInt(a.getStyle("padding-top"))+parseInt(a.getStyle("padding-bottom"))),a.setStyle({width:""})}return c.display=f,c.position=e,c.visibility=d,{width:h,height:g}}}),Object.extend(document.viewport,{getDimensions:function(){var a={},b=Prototype.Browser;return $w("width height").each(function(c){var d=c.capitalize();a[c]=b.WebKit&&!document.evaluate?self["inner"+d]:b.Opera&&parseFloat(opera.version)<9.5?document.body["client"+d]:document.documentElement["client"+d]}),a}});try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e){}String.prototype.getHash||(String.prototype.getHash=function(){var a=this.indexOf("#");return a>=0?this.substring(a+1):null}),String.prototype.toSlug||(String.prototype.toSlug=function(){return this.gsub(/['"]/,"").gsub(/[^A-Za-z0-9]/," ").strip().gsub(/ +/,"-").toLowerCase()});var PageWidget=Behavior.create({initialize:function(a){this.setOptions(a)},setOptions:function(a){this.CONFIG=Object.extend(Object.clone(this.constructor.CONFIG),a||{})}});PageWidget.CONFIG={},document.observe("dom:loaded",function(){function a(){$A(this.options).each(function(a){$(a).disabled&&(a.selected=!1)})}$$("SELECT").each(function(b){Event.observe(b,"change",a.bind(b))})}),(Prototype.Browser.IE||Prototype.Browser.WebKit)&&document.observe("dom:loaded",function(){$$("LABEL IMG").each(function(a){var b=$(a.parentNode.getAttribute("for")&&a.parentNode.attributes["for"].nodeValue);b&&a.observe("click",function(){b.focus()})})});var AdvancedSearch=Behavior.create(PageWidget,{initialize:function(a){this.setOptions(a),this.primary_fields=this.element.select(this.CONFIG.primrary_fields_selector),this.primary_fields.length<1||(this.add_new_line=$(this.CONFIG.add_new_line_id),this.reset_all_fields=$(this.CONFIG.reset_all_fields_id),this.element.select(".Invisible").invoke("removeClassName","Invisible"),this.new_field_template=this.primary_fields.last().cloneNode(!0),this.primary_fields.each(function(a){this.initializePrimaryField(a)},this),this.add_new_line.observe("click",this.addNewPrimaryFieldClickHandler.bindAsEventListener(this)),this.reset_all_fields.observe("click",this.resetAllFieldsClickHandler.bindAsEventListener(this)))},initializePrimaryField:function(a){var b=a.down(this.CONFIG.move_field_button_selector),c=a.select("SELECT");c.length>1?b.observe("click",this.moveFieldUpClickHandler.bindAsEventListener(this,b)):b.addClassName(this.CONFIG.move_field_disabled_button_class).src=this.CONFIG.disabled_button_image},addNewPrimaryFieldClickHandler:function(){this.addNewPrimaryField()},moveFieldUpClickHandler:function(a,b){b.hasClassName(this.CONFIG.move_field_disabled_button_class)||this.moveFieldUp(a,b)},resetAllFieldsClickHandler:function(){this.resetAllFields()},prepareNewPrimaryFieldTemplate:function(){var a=this.primary_fields.length+1;return this.new_field_template.innerHTML.replace(/(name|id|for)\=\"?(\w+_)\d+\"?/g,'$1="$2'+a+'"')},addNewPrimaryField:function(){var a=new Element("P",{"class":"field-group"}).update(this.prepareNewPrimaryFieldTemplate());this.primary_fields.last().insert({after:a}),this.primary_fields.push(a),this.initializePrimaryField(a)},moveFieldUp:function(a,b){var c=b.up(),d=c.previous(),e=c.select("SELECT"),f=d.select("SELECT");f.length>1&&this.swapSelectMenu(e[0],f[0]),this.swapTextField(c.down("INPUT"),d.down("INPUT")),this.swapSelectMenu(e[1],f.last())},swapTextField:function(a,b){var c=$F(b);b.value=$F(a),a.value=c},swapSelectMenu:function(a,b){var c=b.selectedIndex;b.selectedIndex=a.selectedIndex,a.selectedIndex=c},resetAllFields:function(){this.primary_fields.each(function(a){a.down("INPUT").clear(),a.select("SELECT").each(function(a){a.selectedIndex=0})})}});AdvancedSearch.CONFIG={disabled_button_image:"assets/img/icon.to-top.disabled.gif",conditional_prefix:"search_conditional_",term_prefix:"search_term_",search_in_prefix:"search_in_",primrary_fields_selector:".primary-fields .field-group",add_new_line_id:"add-new-line",reset_all_fields_id:"reset-all-fields",move_field_button_selector:"IMG.button",move_field_disabled_button_class:"disabled"},Event.addBehavior({".advanced-search .primary-search":AdvancedSearch});var AjaxImageSubmit=Behavior.create(PageWidget,{initialize:function(a){this.ajax_form=this.element.up("FORM"),this.ajax_form&&"input"!=!this.element.tagName.toLowerCase()&&(this.setOptions(a),this.replaceInputElement(),this.trigger_observer=this.clickHandler.bindAsEventListener(this),this.element.observe("mousedown",this.trigger_observer),this.click_handler_callback=this.CONFIG.click_callback.bind(this),this.success_handler_callback=this.CONFIG.success_handler.bind(this),this.failure_handler_callback=this.CONFIG.failure_handler.bind(this),this.parameters=this.CONFIG.ajax_parameters)},replaceInputElement:function(){var a=new Element("IMG",{id:this.element.id,"class":this.element.className,src:this.element.src});this.element.insert({after:a}).remove(),this.element=a},clickHandler:function(a){a.stop(),this.submitAjaxForm(),this.click_handler_callback()},submitAjaxForm:function(){new Ajax.Request(this.ajax_form.action,{method:this.ajax_form.method,evalJSON:"force",parameters:this.parameters,onSuccess:this.successHandler.bind(this),onFailure:this.failureHandler.bind(this)})},successHandler:function(a){this.validateResponseJSON(a)&&(this.success_handler_callback(),this.toggleTriggerImage())},failureHandler:function(){this.element.stopObserving("click",this.trigger_observer),this.failure_handler_callback()},validateResponseJSON:function(a){if(!this.CONFIG.require_json_validation)return!0;try{return a.responseJSON[this.CONFIG.valid_json_key]==this.CONFIG.valid_json_value?!0:!1}catch(b){return!1}},toggleTriggerImage:function(){this.CONFIG.trigger_image_1.empty()||this.CONFIG.trigger_image_2.empty()||(this.element.src=this.element.src.split("/").last()==this.CONFIG.trigger_image_1.split("/").last()?this.CONFIG.trigger_image_2:this.CONFIG.trigger_image_1)}});AjaxImageSubmit.CONFIG={ajax_parameters:{},trigger_image_1:"",trigger_image_2:"",require_json_validation:!1,valid_json_key:"",valid_json_value:"",click_callback:Prototype.emptyFunction,success_handler:Prototype.emptyFunction,failure_handler:Prototype.emptyFunction},Event.addBehavior({"#set-alert-on-this-journal":AjaxImageSubmit({trigger_image_1:"assets/img/btn.alert-on-journal.gif",trigger_image_2:"assets/img/btn.alert-on-journal-set.gif"}),"#favorite-journal":AjaxImageSubmit({trigger_image_1:"assets/img/btn.favorite-journal.gif",trigger_image_2:"assets/img/btn.journal-favorited.gif"})});var BrowseBySubject=Behavior.create(PageWidget,{initialize:function(a){this.setOptions(a),this.data_list=$("subjects-data-list"),this.data_list&&(this.column_wrapper=$("column-wrapper"),this.column_width=this.CONFIG.column_width,this.selected_subjects=[],this.expanded_subjects={},this.initializeSubjectList(this.data_list))},initializeSubjectList:function(a){a.select(this.CONFIG.category_selector).each(function(a){a.down("A").shiftAttribute("title","href").removeAttribute("href"),a.observe("click",this.selectExpandableSubjectClickHandler.bindAsEventListener(this,a))},this)},selectExpandableSubjectClickHandler:function(a,b){this.expandSubject(a,b)},expandSubject:function(a,b){if(!b.hasClassName("Active")){this.scollToCorrectColumn(b),this.toggleColumnWrapperWidth(!0);var c=b.down(".Collapsed");this.column_wrapper.insert({bottom:c}),this.expanded_subjects[c.id]=b.id,b.addClassName("Active").down("A").shiftAttribute("href","title"),c.removeClassName("Collapsed").addClassName("Expanded"),a.stop()}},scollToCorrectColumn:function(a){var b=a.ancestors(),c=a.up(".Column").nextSiblings();c.each(function(a){a.hasClassName("Expanded")&&!b.include(a)&&this.removeColumn(a)},this)},toggleColumnWrapperWidth:function(a){this.column_width=a?this.column_width+200:this.column_width-200,this.column_wrapper.setStyle({width:this.column_width+"px"}),this.data_list.scrollDiv(this.column_width,0)},removeColumn:function(a){var b=$(this.expanded_subjects[a.id]);b.insert({bottom:a}).removeClassName("Active").down("A").removeAttribute("href"),a.removeClassName("Expanded").addClassName("Collapsed"),this.toggleColumnWrapperWidth(!1)}});BrowseBySubject.CONFIG={column_width:200,category_selector:".Expandable"},Event.addBehavior({"#browse-by-subject":BrowseBySubject});var DHTMLMenu=Behavior.create(PageWidget,{initialize:function(a){this.setOptions(a),this.submenus={},this.element.immediateDescendants().each(function(a){a.observe("mouseover",this.mouseoverHandler.bindAsEventListener(this,a)),a.observe("mouseout",this.mouseoutHandler.bindAsEventListener(this,a)),this.submenus[a.id]=a.down().next(),void 0==this.submenus[a.id]&&a.select("UL").length>0&&(this.submenus[a.id]=a.down("UL"))},this)},initialized:!1,menu_hide_timeout:null,menu_show_timeout:null,last_menu_on:null,mouseoverHandler:function(a,b){clearTimeout(this.menu_hide_timeout),clearTimeout(this.menu_show_timeout),null==this.last_menu_on?this.menu_show_timeout=setTimeout(this.showMenu.bind(this,b),this.CONFIG.menu_show_time):this.last_menu_on!=b&&this.showMenu(b)},mouseoutHandler:function(a,b){clearTimeout(this.menu_hide_timeout),clearTimeout(this.menu_show_timeout),this.submenus[b.id]?this.menu_hide_timeout=setTimeout(this.hideMenu.bind(this,b),this.CONFIG.menu_hide_time):this.hideMenu(b)},showMenu:function(a){if(null!=this.last_menu_on&&this.hideMenu(this.last_menu_on),a.addClassName(this.CONFIG.hover_class),Prototype.Browser.IE6){var b=this.submenus[a.id];if(b){var c=b.next();b&&!c&&this.createIframe(a,{left:b.offsetLeft+"px",height:b.offsetHeight+"px",width:b.offsetWidth+"px"})}}this.last_menu_on=a},hideMenu:function(a){if(null!=a){if(a.removeClassName(this.CONFIG.hover_class),Prototype.Browser.IE6){var b=this.submenus[a.id];if(b){var c=b.next();b&&c&&a.removeChild(c)}}this.last_menu_on=null}},createIframe:function(a,b){new Insertion.Bottom(a,new Template('<iframe class="'+this.CONFIG.iframe_class+'" frameborder="0" scrolling="no" style="width: #{width}; height: #{height}; left: #{left};"></iframe>').evaluate(b))}});DHTMLMenu.CONFIG={submenu_class:"SubMenu",hover_class:"Hover",menu_hide_time:500,menu_show_time:100,iframe_class:"IframeFix"},Event.addBehavior({".DHTMLMenu":DHTMLMenu({menu_hide_time:300})});var ExpertSearch=Behavior.create(PageWidget,{initialize:function(a){if(this.expression=$(a),this.expression){for(this.element.setStyle({display:"block"}),x=0;4>x;x++)this.initializeDropDownMenu(this.element.down(".DropDown",x));$("reset-all").setStyle({display:"block"}).observe("click",this.resetTextArea.bindAsEventListener(this))}},initializeDropDownMenu:function(a){a.select("LI").each(function(a){a.observe("click",this.dropDownItemClickHandler.bindAsEventListener(this,a))},this)},dropDownItemClickHandler:function(a,b){string=b.id.split("-").last(),b.hasClassName("Operator")?this.addItem(b,"<"+string+">"):this.addItem(b,string)},addItem:function(a,b){this.hideParentMenu(a);var c=$F(this.expression);this.expression.value=c.endsWith(" ")?c+b:c.empty()?b:c+" "+b},hideParentMenu:function(a){a.up(".DropDown").removeClassName("Hover")},resetTextArea:function(){this.expression.clear()}});Event.addBehavior({"#expression-tools":ExpertSearch("expression-textarea")});var HoverHighlighter=Behavior.create(PageWidget,{initialize:function(a,b){this.setOptions(b),this.highlightable_items=this.element.select(a),this.highlightable_items.size()<1||(this.highlightable_items.each(function(a){a.observe("mouseover",this.itemMouseHandler.bindAsEventListener(this,a,!0)),a.observe("mouseout",this.itemMouseHandler.bindAsEventListener(this,a,!1))},this),this.mouseOverCallback=this.CONFIG.mouseover_callback,this.mouseOutCallback=this.CONFIG.mouseout_callback)},itemMouseHandler:function(a,b,c){c?(b.addClassName(this.CONFIG.hover_class),this.mouseOverCallback()):(b.removeClassName(this.CONFIG.hover_class),setTimeout(this.mouseOutCallback,20))}});HoverHighlighter.CONFIG={hover_class:"Hover",mouseover_callback:Prototype.emptyFunction,mouseout_callback:Prototype.emptyFunction},Event.addBehavior({"UL.Results":HoverHighlighter("LI"),"#BrowseContent":HoverHighlighter("UL.Browsing > LI"),"UL.Profiles":HoverHighlighter("LI"),"UL.listview-highlight":HoverHighlighter("LI"),"#expression-tools .SubMenu":HoverHighlighter("LI"),"UL.Searches":HoverHighlighter("LI.Hoverable"),"UL.AlertsFeeds":HoverHighlighter("LI.Hoverable")});var MaintenanceMessage=Behavior.create(PageWidget,{initialize:function(a){this.setOptions(a),this.form_input=this.element.down("INPUT"),this.close_link=this.element.down("SPAN"),this.form_input&&this.close_link&&(this.form_input.setStyle({display:"none"}),this.close_link.setStyle({display:"block"}).observe("click",this.closeClickHandler.bindAsEventListener(this)))},closeClickHandler:function(){new Ajax.Request(this.element.action,{method:this.element.method,evalJSON:"force",onSuccess:this.closeMaintenanceSuccessHandler.bind(this),onFailure:this.closeMaintenanceFailureHandler.bind(this)})},closeMaintenanceSuccessHandler:function(a){a.responseJSON.response?new Effect.Fade(this.element.id):this.closeMaintenanceFailureHandler()},closeMaintenanceFailureHandler:function(){this.removeMaintenanceMessage(this.CONFIG.failure_message_text.empty()?!1:!0)},removeMaintenanceMessage:function(a){a?(this.element.innerHTML=this.CONFIG.failure_message_text,new Effect.Fade(this.element.id,{delay:this.CONFIG.failure_message_auto_dismiss_time})):new Effect.Fade(this.element.id)}});MaintenanceMessage.CONFIG={failure_message_text:"",failure_message_auto_dismiss_time:3},Event.addBehavior({"#maintenance-message":MaintenanceMessage({failure_message_text:"Error: Unable to save maintenance message preferences.",failure_message_auto_dismiss_time:1})});var MasterCheckbox=Behavior.create(PageWidget,{initialize:function(a,b){this.setOptions(b),this.master_checkbox=$(a),this.checkbox_nodes=this.element.select('input[type="checkbox"]').without(this.master_checkbox),!this.master_checkbox||this.checkbox_nodes.size()<1||(this.master_checkbox.checked=!0,this.masterCheckboxClickHandler(),this.master_checkbox.observe("click",this.masterCheckboxClickHandler.bindAsEventListener(this)),this.checkbox_nodes.each(function(a){a.observe("click",this.checkboxClickHandler.bindAsEventListener(this))},this))},masterCheckboxClickHandler:function(){var a=!0;this.checkbox_nodes.each(this.master_checkbox.checked?function(a){a.checked=!1}:function(b){b.checked&&(a=!1)}),this.checkMasterCheckbox(a)},checkboxClickHandler:function(){this.master_checkbox.checked&&(this.master_checkbox.checked=!1);var a=!0;this.checkbox_nodes.each(function(b){b.checked&&(a=!1)}),this.checkMasterCheckbox(a)},checkMasterCheckbox:function(a){a&&(this.master_checkbox.checked=!0)}});Event.addBehavior({"#choose-sources .layout":MasterCheckbox("select-all-checkboxes")});var NarrowByAuthors=Class.create(PageWidget,{initialize:function(a,b,c){this.setOptions(c),this.node=$(a),this.authors_to_select_list=$(this.CONFIG.authors_to_select_list_id),this.selected_authors_list=$(this.CONFIG.selected_authors_list_id),this.node&&this.authors_to_select_list&&this.selected_authors_list&&(this.fetchAuthors("citations"),this.sorting_by_name=!1,this.selected_authors=[],this.authors_data={},this.selected_authors_input=$(this.CONFIG.selected_authors_input_id),this.select_heading=$(this.CONFIG.select_heading_id),this.most_citations=$(this.CONFIG.most_citations_heading_id),this.sort_by_citations=$(this.CONFIG.sort_by_citations_id),this.sort_by_citations.observe("click",this.setSortAuthorsByCitations.bindAsEventListener(this)),this.sort_by_last_name=$(this.CONFIG.sort_by_last_name_id),this.sort_by_last_name.observe("click",this.setSortAuthorsByLastName.bindAsEventListener(this)),$(this.CONFIG.clear_all_selected_id).observe("click",this.removeAllAuthors.bindAsEventListener(this)),this.narrow_controls=$(this.CONFIG.narrow_controls_wrapper_id),this.narrow_controls.select("A").each(function(a){a.observe("click",this.filterClickHandler.bindAsEventListener(this,a))},this),this.boldAuthorSortingByName(this.sorting_by_name),this.boldFilterList("most citations"))},fetchAuthors:function(a){var b="citations"==a?"request=citations":"request="+a;new Ajax.Request("ajax/authors.json.php",{method:"get",parameters:b,evalJSON:"force",onSuccess:this.fetchAuthorsSuccessHandler.bind(this),onFailure:this.fetchAuthorsFailureHandler.bind(this)})},fetchAuthorsSuccessHandler:function(a){var b=a.responseJSON.results;b?this.handleFetchedAuthorData(b):this.fetchAuthorsFailureHandler()},fetchAuthorsFailureHandler:function(){this.node.up().setStyle({display:"none"})},handleFetchedAuthorData:function(a){a.citations?(this.authors_by_citation=a.citations,this.displayBatchOfAuthors(this.authors_by_citation)):($H(a).each(function(a){this.loadAuthorByLastName(a)},this),this.awaiting_letter&&(this.displayBatchOfAuthors(this.authors_data[this.awaiting_letter][1]),this.awaiting_letter=null))},loadAuthorByLastName:function(a){if(!this.authors_data[a.key])for(this.authors_data[a.key]=[],x=0;x<a.length;x++)this.authors_data[a.key].push(a[x])},displayBatchOfAuthors:function(a){this.clearAuthorsToSelectList(),a.each(function(a){this.displayAuthorToSelect(a)},this)},displayAuthorToSelect:function(a){var b=new Element("LI",{id:"author-"+a[0]});b.update("<span>"+a[1]+" ("+a[2]+")</span>"),this.selected_authors&&this.selected_authors.include(a[0])&&b.addClassName("Selected"),this.authors_to_select_list.insert({bottom:b}),b.observe("click",this.selectAuthorClickHandler.bind(this,b,a[0]))},filterClickHandler:function(a,b){var c=b.innerHTML.toLowerCase();"most citations"==c?(this.filterAuthorsByCitations(),this.select_heading.update("Authors with the Most Citations")):(this.filterAuthorsByLastName(c),this.select_heading.update("Authors by Last Name: "+b.innerHTML)),this.last_clicked=c,this.boldFilterList(c),this.activateSorting(this.sorting_by_name)},filterAuthorsByCitations:function(){this.sorting_by_name=!1,this.boldAuthorSortingByName(!1),this.authors_by_citation?this.displayBatchOfAuthors(this.authors_by_citation):this.fetchAuthors("citations")},filterAuthorsByLastName:function(a){this.sorting_by_name=!0,this.boldAuthorSortingByName(!0),this.authors_data[a]?this.displayBatchOfAuthors(this.authors_data[a][1]):(this.awaiting_letter=a,this.fetchAuthors(a))},selectAuthorClickHandler:function(a,b){this.selectAuthor(b,a)},activateSorting:function(a){a?this.setSortAuthorsByLastName():this.setSortAuthorsByCitations()},setSortAuthorsByCitations:function(){this.current_result=[],this.citation_amounts=[],this.by_author_citations=new Hash,this.sorting_by_name=!1,this.boldAuthorSortingByName(this.sorting_by_name);var a=this.authors_to_select_list.select("LI").sortBy(function(a){return parseInt(a.innerHTML.gsub(/(.*)\((.*)\)(.*)/,"#{2}"))});a.each(function(a){var b=parseInt(a.innerHTML.gsub(/(.*)\((.*)\)(.*)/,"#{2}"));this.by_author_citations[b]||(this.by_author_citations[b]=[],this.citation_amounts.push(b)),this.by_author_citations[b].push(a)},this),this.citation_amounts.each(function(a){this.by_author_citations[a]=this.by_author_citations[a].sortBy(function(a){return a.innerHTML.stripTags().gsub(/(.*)\((.*)\)(.*)/,"#{1}").strip().slice(1,2)},this)},this),this.citation_amounts.each(function(a){this.by_author_citations[a].reverse(),this.by_author_citations[a].each(function(a){this.current_result.push(a)},this)},this),this.clearAuthorsToSelectList(),this.displaySortedAuthors(this.current_result.reverse())},setSortAuthorsByLastName:function(){if(this.sorting_by_name=!0,this.boldAuthorSortingByName(this.sorting_by_name),"most citations"==this.last_clicked)var a=this.authors_to_select_list.select("LI").sortBy(function(a){return a.innerHTML.stripTags().gsub(/(.*)\((.*)\)(.*)/,"#{1}").strip().slice(0,1)});else var a=this.authors_to_select_list.select("LI").sortBy(function(a){return a.innerHTML.stripTags().gsub(/(.*)\((.*)\)(.*)/,"#{1}").strip().slice(1,2)});this.clearAuthorsToSelectList(),this.displaySortedAuthors(a)},boldAuthorSortingByName:function(a){a?this.sort_by_last_name:this.sort_by_citations;a?(this.sort_by_citations.removeClassName(this.CONFIG.active_filter_class),this.sort_by_last_name.addClassName(this.CONFIG.active_filter_class)):(this.sort_by_last_name.removeClassName(this.CONFIG.active_filter_class),this.sort_by_citations.addClassName(this.CONFIG.active_filter_class))},boldFilterList:function(a){this.narrow_controls.select("A").invoke("removeClassName",this.CONFIG.active_filter_class),"most citations"==a?this.most_citations.addClassName(this.CONFIG.active_filter_class):$("filter-"+a).addClassName(this.CONFIG.active_filter_class)},selectAuthor:function(a,b){this.selected_authors.include(a)||(this.selected_authors.push(a),this.copyAuthorNodeToSelectedList(a,b),this.updateSelectedAuthorsInput(),b.addClassName(this.CONFIG.selected_author_class))},displaySortedAuthors:function(a){a.each(function(a){this.authors_to_select_list.insert({bottom:a})},this)},copyAuthorNodeToSelectedList:function(a,b){var c=new Element("LI");c.update(b.innerHTML),this.selected_authors_list.insert({bottom:c}),c.observe("click",this.removeSelectedAuthor.bind(this,a,c))},removeSelectedAuthor:function(a,b){b.remove(),this.selected_authors=this.selected_authors.without(a),this.updateSelectedAuthorsInput(),$("author-"+a)&&$("author-"+a).removeClassName(this.CONFIG.selected_author_class)},removeAllAuthors:function(){this.selected_authors=[],this.updateSelectedAuthorsInput(),this.selected_authors_list.select("LI").invoke("remove"),this.authors_to_select_list.select("."+this.CONFIG.selected_author_class).invoke("removeClassName",this.CONFIG.selected_author_class)},clearAuthorsToSelectList:function(){this.authors_to_select_list.select("LI").invoke("remove")},updateSelectedAuthorsInput:function(){this.selected_authors_input.value=this.selected_authors}});NarrowByAuthors.CONFIG={authors_to_select_list_id:"authors-to-select-list",selected_authors_list_id:"selected-authors-list",selected_authors_input_id:"selected_authors_input",select_heading_id:"authors-to-select-heading",most_citations_heading_id:"most-citations",sort_by_citations_id:"sort-by-citations",sort_by_last_name_id:"sort-by-last-name",narrow_controls_wrapper_id:"narrow-controls",clear_all_selected_id:"clear-all-selected",active_filter_class:"Active",selected_author_class:"Selected"};var NarrowByDate=Class.create(PageWidget,{initialize:function(a){this.setOptions(a),this.start_date_input=$(this.CONFIG.start_date_input).disable(),this.end_date_input=$(this.CONFIG.end_date_input).disable(),this.slider=$(this.CONFIG.slider),this.slide_scroller=$(this.CONFIG.slide_scroller),this.active_slide_range=$(this.CONFIG.slider_active_range),this.slider_width=this.CONFIG.slider_width,this.start_date_slider=$(this.CONFIG.start_date_slider),this.end_date_slider=$(this.CONFIG.end_date_slider),this.fetchYearRange()},fetchYearRange:function(){new Ajax.Request(this.CONFIG.ajax_href,{method:"get",evalJSON:"force",onSuccess:this.fetchSuccessHandler.bind(this),onFailure:this.fetchFailureHandler.bind(this)})},fetchFailureHandler:function(){$(this.CONFIG.wrapper_id).setStyle({display:"none"})},fetchSuccessHandler:function(a){this.start_year=a.responseJSON.start,this.end_year=a.responseJSON.end,this.renderLabels(),this.calculateYears(),this.createSlider(),this.drawActiveRange(),this.original_start_position=this.start_date_slider.style.left,this.original_end_position=this.end_date_slider.style.left},renderLabels:function(){var a=$(this.CONFIG.start_date_label),b=$(this.CONFIG.end_date_label);a&&(a.innerHTML=this.start_year,this.start_date_input.value=this.start_year),b&&(b.innerHTML=this.end_year,this.end_date_input.value=this.end_year)},calculateYears:function(){var a=new Date,b=a.getFullYear(),c=b-this.CONFIG.first_year;this.inner_date_range=this.end_year-this.start_year,this.inner_width=parseInt(this.CONFIG.slider_width*(this.inner_date_range/c)),from_left=Math.round(this.CONFIG.slider_width/c)*(this.start_year-this.CONFIG.first_year),this.slide_scroller.setStyle({width:this.inner_width+"px",marginLeft:from_left+"px"}),this.increment=this.inner_date_range/this.slide_scroller.getWidth()},createSlider:function(){this.slider_control=new Control.Slider([this.start_date_slider,this.end_date_slider],this.slider,{increment:this.increment,range:$R(this.start_year,this.end_year),minimum:this.start_year,maximum:this.end_year,restricted:!0,sliderValue:[this.start_year,this.end_year],onSlide:function(a){this.updateSliderValue(a)}.bind(this),onChange:function(a){this.updateSliderValue(a)}.bind(this)})},updateSliderValue:function(a){this.start_date_input.value=parseInt(a[0]),this.end_date_input.value=parseInt(a[1]),this.drawActiveRange()},drawActiveRange:function(){this.active_slide_range.setStyle({left:this.start_date_slider.style.left,width:parseInt(this.end_date_slider.style.left)-12-parseInt(this.start_date_slider.style.left)+this.end_date_slider.getWidth()-10+"px"})}});NarrowByDate.CONFIG={wrapper_id:"narrow-by-date",ajax_href:"ajax/narrow_by_date.json.php",first_year:1913,slider:"slider",slide_scroller:"slider-scroll",slider_active_range:"active-range",slider_width:500,start_date_slider:"start-date-slider",end_date_slider:"end-date-slider",start_date_input:"start-date",end_date_input:"end-date",start_date_label:"start-label",end_date_label:"end-label"};var NarrowByPublications=Class.create(PageWidget,{initialize:function(a,b,c){this.setOptions(c),this.node=$(a),this.publications_to_select_list=$(this.CONFIG.publications_to_select_list_id),this.selected_publications_list=$(this.CONFIG.selected_publications_list_id),this.node&&this.publications_to_select_list&&this.selected_publications_list&&(this.fetchPublications("citations"),this.sorting_by_name=!1,this.selected_publications=[],this.publications_data={},this.selected_publications_input=$(this.CONFIG.selected_publications_input_id),this.select_heading=$(this.CONFIG.select_heading_id),this.most_citations=$(this.CONFIG.most_citations_heading_id),this.sort_by_citations=$(this.CONFIG.sort_by_citations_id),this.sort_by_citations.observe("click",this.setSortPublicationsByCitations.bindAsEventListener(this)),this.sort_by_name=$(this.CONFIG.sort_by_name_id),this.sort_by_name.observe("click",this.setSortPublicationsByName.bindAsEventListener(this)),$(this.CONFIG.clear_all_selected_id).observe("click",this.removeAllPublications.bindAsEventListener(this)),this.narrow_controls=$(this.CONFIG.narrow_controls_wrapper_id),this.narrow_controls.select("A").each(function(a){a.observe("click",this.filterClickHandler.bindAsEventListener(this,a))},this),this.boldPublicationSortingByName(this.sorting_by_name),this.boldFilterList("most citations"),this.last_clicked="most citations")},fetchPublications:function(a){var b="citations"==a?"request=citations":"request="+a;new Ajax.Request("ajax/publications.json.php",{method:"get",parameters:b,evalJSON:"force",onSuccess:this.fetchPublicationsSuccessHandler.bind(this),onFailure:this.fetchPublicationsFailureHandler.bind(this)})},fetchPublicationsSuccessHandler:function(a){var b=a.responseJSON.results;b?this.handleFetchedPublicationData(b):this.fetchPublicationsFailureHandler()},fetchPublicationsFailureHandler:function(){this.node.up().setStyle({display:"none"})},handleFetchedPublicationData:function(a){a.citations?(this.publications_by_citation=a.citations,this.displayBatchOfPublications(this.publications_by_citation)):($H(a).each(function(a){this.loadPublicationByName(a)},this),this.awaiting_letter&&(this.displayBatchOfPublications(this.publications_data[this.awaiting_letter][1]),this.awaiting_letter=null))},loadPublicationByName:function(a){if(!this.publications_data[a.key])for(this.publications_data[a.key]=[],x=0;x<a.length;x++)this.publications_data[a.key].push(a[x])},displayBatchOfPublications:function(a){this.clearPublicationsToSelectList(),a.each(function(a){this.displayPublicationToSelect(a)},this)},displayPublicationToSelect:function(a){var b=new Element("LI",{id:"publication-"+a[0]});b.update("<span>"+a[1]+" ("+a[2]+")</span>"),this.selected_publications&&this.selected_publications.include(a[0])&&b.addClassName("Selected"),this.publications_to_select_list.insert({bottom:b}),b.observe("click",this.selectPublicationClickHandler.bind(this,b,a[0]))},filterClickHandler:function(a,b){var c=b.innerHTML.toLowerCase();"most citations"==c?(this.filterPublicationsByCitations(),this.select_heading.update("Publications with the Most Citations")):(this.filterPublicationsByName(c),this.select_heading.update("Publications by Name: "+b.innerHTML)),this.last_clicked=c,this.boldFilterList(c),this.activateSorting(this.sorting_by_name)},filterPublicationsByCitations:function(){this.sorting_by_name=!1,this.boldPublicationSortingByName(!1),this.publications_by_citation?this.displayBatchOfPublications(this.publications_by_citation):this.fetchPublications("citations")},filterPublicationsByName:function(a){this.sorting_by_name=!0,this.boldPublicationSortingByName(!0),this.publications_data[a]?this.displayBatchOfPublications(this.publications_data[a][1]):(this.awaiting_letter=a,this.fetchPublications(a))},selectPublicationClickHandler:function(a,b){this.selectPublication(b,a)},activateSorting:function(a){a?this.setSortPublicationsByName():this.setSortPublicationsByCitations()},setSortPublicationsByCitations:function(){this.current_result=[],this.citation_amounts=[],this.by_publication_citations=new Hash,this.sorting_by_name=!1,this.boldPublicationSortingByName(this.sorting_by_name);var a=this.publications_to_select_list.select("LI").sortBy(function(a){return parseInt(a.innerHTML.gsub(/(.*)\((.*)\)(.*)/,"#{2}"))});a.each(function(a){var b=parseInt(a.innerHTML.gsub(/(.*)\((.*)\)(.*)/,"#{2}"));this.by_publication_citations[b]||(this.by_publication_citations[b]=[],this.citation_amounts.push(b)),this.by_publication_citations[b].push(a)},this),this.citation_amounts.each(function(a){this.by_publication_citations[a]=this.by_publication_citations[a].sortBy(function(a){return a.innerHTML.stripTags().gsub(/(.*)\((.*)\)(.*)/,"#{1}").strip().split(" ").pop().slice(1,2)},this)},this),this.citation_amounts.each(function(a){this.by_publication_citations[a].reverse(),this.by_publication_citations[a].each(function(a){this.current_result.push(a)
},this)},this),this.clearPublicationsToSelectList(),this.displaySortedPublications(this.current_result.reverse())},setSortPublicationsByName:function(){if(this.sorting_by_name=!0,this.boldPublicationSortingByName(this.sorting_by_name),"most citations"==this.last_clicked)var a=this.publications_to_select_list.select("LI").sortBy(function(a){return a.innerHTML.stripTags().gsub(/(.*)\((.*)\)(.*)/,"#{1}").strip().split(" ")[0].slice(0,1)});else var a=this.publications_to_select_list.select("LI").sortBy(function(a){return a.innerHTML.stripTags().gsub(/(.*)\((.*)\)(.*)/,"#{1}").strip().split(" ")[0].slice(1,2)});this.clearPublicationsToSelectList(),this.displaySortedPublications(a)},boldPublicationSortingByName:function(a){a?this.sort_by_name:this.sort_by_citations;a?(this.sort_by_citations.removeClassName(this.CONFIG.active_filter_class),this.sort_by_name.addClassName(this.CONFIG.active_filter_class)):(this.sort_by_name.removeClassName(this.CONFIG.active_filter_class),this.sort_by_citations.addClassName(this.CONFIG.active_filter_class))},boldFilterList:function(a){this.narrow_controls.select("A").invoke("removeClassName",this.CONFIG.active_filter_class),"most citations"==a?this.most_citations.addClassName(this.CONFIG.active_filter_class):$("filter-"+a).addClassName(this.CONFIG.active_filter_class)},selectPublication:function(a,b){this.selected_publications.include(a)||(this.selected_publications.push(a),this.copyPublicationNodeToSelectedList(a,b),this.updateSelectedPublicationsInput(),b.addClassName(this.CONFIG.selected_publication_class))},displaySortedPublications:function(a){a.each(function(a){this.publications_to_select_list.insert({bottom:a})},this)},copyPublicationNodeToSelectedList:function(a,b){var c=new Element("LI");c.update(b.innerHTML),this.selected_publications_list.insert({bottom:c}),c.observe("click",this.removeSelectedPublication.bind(this,a,c))},removeSelectedPublication:function(a,b){b.remove(),this.selected_publications=this.selected_publications.without(a),this.updateSelectedPublicationsInput(),$("publication-"+a)&&$("publication-"+a).removeClassName(this.CONFIG.selected_publication_class)},removeAllPublications:function(){this.selected_publications=[],this.updateSelectedPublicationsInput(),this.selected_publications_list.select("LI").invoke("remove"),this.publications_to_select_list.select("."+this.CONFIG.selected_publication_class).invoke("removeClassName",this.CONFIG.selected_publication_class)},clearPublicationsToSelectList:function(){this.publications_to_select_list.select("LI").invoke("remove")},updateSelectedPublicationsInput:function(){this.selected_publications_input.value=this.selected_publications}});NarrowByPublications.CONFIG={publications_to_select_list_id:"publications-to-select-list",selected_publications_list_id:"selected-publications-list",selected_publications_input_id:"selected_publications_input",select_heading_id:"publications-to-select-heading",most_citations_heading_id:"publications-most-citations",sort_by_citations_id:"sort-publications-by-citations",sort_by_name_id:"sort-publications-by-name",narrow_controls_wrapper_id:"publications-narrow-controls",clear_all_selected_id:"clear-all-selected-publications",active_filter_class:"Active",selected_publication_class:"Selected"};var NarrowBySubject=Class.create(PageWidget,{initialize:function(a,b){this.setOptions(b),this.data_list=$(this.CONFIG.data_list_id),this.data_list&&(this.selected_subjects_list=$(this.CONFIG.selected_list_id),this.column_wrapper=$(this.CONFIG.column_wrapper_id),this.column_width=this.CONFIG.column_width,this.selected_subjects=[],this.expanded_subjects={},this.initializeSubjectList(this.data_list),$(this.CONFIG.clear_selected_id).observe("click",this.removeAllSubjects.bindAsEventListener(this)))},initializeSubjectList:function(a){a.select(this.CONFIG.category_selector).each(function(a){a.observe("click",this.selectExpandableSubjectClickHandler.bindAsEventListener(this,a))},this),a.select(this.CONFIG.subject_selector).each(function(a){a.observe("click",this.selectSubjectClickHandler.bindAsEventListener(this,a))},this)},selectSubjectClickHandler:function(a,b){this.addSubject(a,b)},selectExpandableSubjectClickHandler:function(a,b){this.selectExpandableSubject(a,b)},selectExpandableSubject:function(a,b){var c=b.cumulativeOffset();a.clientX+this.data_list.scrollLeft<c[0]+16?this.addSubjectContainer(b):this.expandSubject(b)},addSubject:function(a,b){subject_id=b.id.split("-")[1],this.selected_subjects.include(subject_id)||(this.selected_subjects.push(subject_id),this.copySubjectNodeToSelectedList(b),b.addClassName("Selected"))},addSubjectContainer:function(a){if(!this.selected_subjects.include(a.id.split("-")[1])){this.addSubject(this,a);var b=a.hasClassName("Active")?a.up(".Column").next(".Column"):a;b.select("LI").each(function(a){this.selected_subjects.include(a.id.split("-")[1])||(a.hasClassName("Expandable")?this.addSubjectContainer(a):this.addSubject(this,a))},this),this.expandSubject(a)}},expandSubject:function(a){if(!a.hasClassName("Active")){this.scollToCorrectColumn(a);var b=a.down(".Collapsed");this.toggleColumnWrapperWidth(!0),this.column_wrapper.insert({bottom:b}),this.expanded_subjects[b.id]=a.id,a.addClassName("Active"),b.removeClassName("Collapsed").addClassName("Expanded").down("UL").select("LI").each(function(a){this.selected_subjects.include(a.id.split("-")[1])&&a.addClassName("Selected")},this)}},scollToCorrectColumn:function(a){var b=a.ancestors(),c=a.up(".Column").nextSiblings();c.each(function(a){a.hasClassName("Expanded")&&!b.include(a)&&this.removeColumn(a)},this)},toggleColumnWrapperWidth:function(a){this.column_width=a?this.column_width+200:this.column_width-200,this.column_wrapper.setStyle({width:this.column_width+"px"}),this.data_list.scrollDiv(this.column_width,0)},removeColumn:function(a){$(this.expanded_subjects[a.id]).insert({bottom:a}).removeClassName("Active"),a.removeClassName("Expanded").addClassName("Collapsed"),this.toggleColumnWrapperWidth(!1)},copySubjectNodeToSelectedList:function(a){var b=new Element("LI",{id:a.id.split("-")[1]}).update("<span>"+a.down("SPAN").innerHTML+"</span>");this.selected_subjects_list.insert({bottom:b}),b.observe("click",this.removeSelectedSubject.bind(this,b))},removeSelectedSubject:function(a){a.remove(),this.selected_subjects=this.selected_subjects.without(a.id);var b=$("subject-"+a.id);b&&b.removeClassName("Selected")},removeAllSubjects:function(){this.selected_subjects=[],this.selected_subjects_list.select("LI").invoke("remove"),this.data_list.select(".Selected").invoke("removeClassName","Selected")}});NarrowBySubject.CONFIG={column_width:200,category_selector:".Expandable",subject_selector:".Subject",data_list_id:"subjects-data-list",clear_selected_id:"clear-all-selected-subjects",column_wrapper_id:"column-wrapper",selected_list_id:"selected-subjects-list"};var Popup=Behavior.create(PageWidget,{initialize:function(a,b){this.setOptions(b),this.popup_location=a,this.layout_wrapper=$(this.CONFIG.layout_wrapper),this.layout_wrapper&&(this.defineBrowserVariables(),this.definePopupType(),this.createOverlay(),this.element.observe("click",this.popUpClickHandler.bindAsEventListener(this)),this.overlay_observer=this.overlayClickHandler.bindAsEventListener(this),this.initializeCallback=this.CONFIG.initialize_callback.bind(this),this.validateCallback=this.CONFIG.validate_callback.bind(this),this.showCallback=this.CONFIG.show_callback.bind(this),this.hideCallback=this.CONFIG.hide_callback.bind(this),this.initializeCallback())},defineBrowserVariables:function(){this.document_height=this.layout_wrapper.getHeight(),this.vertical_scroll=document.viewport.getScrollOffsets()[1],this.window_height=document.viewport.getHeight(),this.window_width=document.viewport.getWidth(),this.element_position=this.element.positionedOffset()},definePopupType:function(){"a"==this.element.tagName.toLowerCase()&&this.element.setStyle({cursor:"pointer"}).removeAttribute("href"),!this.CONFIG.use_ajax&&this.element.hasClassName(this.CONFIG.dhtml_popup_class)&&this.element.addClassName(this.CONFIG.dhtml_trigger_class).removeClassName(this.CONFIG.dhtml_popup_class)},createOverlay:function(){if(!$("popup_overlay")){var a=new Element("DIV",{id:"popup_overlay",style:"width: "+this.window_width+"px;"});$(document.body).insert({bottom:a})}this.overlay=$("popup_overlay")},popUpClickHandler:function(){window.currently_popped&&window.currently_popped.hidePopup(),this.defineBrowserVariables(),this.popup_container?this.displayPopup():this.fetchPopup()},overlayClickHandler:function(a){a.target==this.overlay&&this.hidePopup()},fetchPopup:function(){this.CONFIG.use_ajax?new Ajax.Request(this.popup_location,{method:"get",onSuccess:this.popUpAjaxSuccessHandler.bind(this),onFailure:this.popUpAjaxFailureHandler.bind(this)}):$(this.popup_location)&&(this.createPopup($(this.popup_location).innerHTML),this.displayPopup())},popUpAjaxSuccessHandler:function(a){this.createPopup(a.responseText),this.displayPopup()},popUpAjaxFailureHandler:function(){alert("The AJAX request failed and the popup cannot load.")},createPopup:function(a){$(this.element.id+"_container")||(this.popup_container=new Element("DIV",{id:this.element.id+"_container","class":"popup_container",style:"position: absolute; width: "+this.popup_width+"px; display: none; z-index: 999;"}),this.overlay.insert({bottom:this.popup_container}),Element.extend(this.popup_container),this.CONFIG.use_ajax?this.popup_container.update(a):this.popup_container.insert($(this.popup_location)),this.calculatePopupDimensions())},calculatePopupDimensions:function(){this.displayOverlay(),this.popup_container.addClassName("Calculating"),this.popup_width=this.popup_container.getWidth(),this.popup_height=this.popup_container.getHeight(),this.popup_container.removeClassName("Calculating"),this.hideOverlay()},displayPopup:function(){window.currently_popped||(Prototype.Browser.IE&&this.hideAllContainers(),this.validated=!0,this.validateCallback(),this.validated&&(window.currently_popped=this,this.positionPopup(),this.displayOverlay(),this.insertIframe(),this.popup_container.setStyle({display:"block"}),this.overlay.observe("click",this.overlay_observer),this.initializePopupElements(),this.showCallback()))},initializePopupElements:function(){if(this.CONFIG.window_submit_selector&&(this.popup_form=this.popup_container.down("FORM"),this.popup_form)){this.popup_form.findFirstElement()&&this.popup_form.focusFirstElement(),this.popup_form_location=this.popup_form.action,this.popup_form_method=this.popup_form.method;var a=this.popup_container.select(this.CONFIG.window_submit_selector);a.size()>0&&a.each(function(a){a.observe("click",this.submitPopupForm.bind(this))},this)}if(this.CONFIG.window_close_selector){var b=this.popup_container.select(this.CONFIG.window_close_selector);b.size()>0&&b.each(function(a){a.observe("click",this.hidePopup.bind(this))},this)}},submitPopupForm:function(){this.popup_form&&new Ajax.Request(this.popup_form_location,{onSuccess:this.CONFIG.form_onsuccess_callback,onFailure:this.CONFIG.form_onfailure_callback}),this.hidePopup()},displayOverlay:function(){this.overlay.setStyle({height:this.document_height+"px",display:"block",visibility:"visible"})},hideOverlay:function(){this.popup_container.visible()&&this.hidePopup(),this.overlay.setStyle({display:"none",visibility:"hidden"})},insertIframe:function(){Prototype.Browser.IE6&&this.createIframe(this.popup_container,{top:this.popup_container.style.top,left:this.popup_container.style.left,height:this.popup_height+"px",width:this.popup_width+"px"})},removeIframe:function(){if(Prototype.Browser.IE6){var a=$("popup-iframe");a&&a.remove()}},createIframe:function(a,b){new Insertion.Bottom(a.up(),new Template('<iframe id="popup-iframe" frameborder="0" scrolling="no" style="width: #{width}; height: #{height}; left: #{left}; top: #{top}; position: absolute; z-index: 502;"></iframe>').evaluate(b))},positionPopup:function(){switch(this.CONFIG.position){case"auto":this.popup_container.setStyle({top:this.window_height/2-this.popup_height/2+this.vertical_scroll+"px",left:(this.window_width-this.popup_width)/2+"px"});break;case"vertical":this.popup_container.setStyle({top:this.element_position[1]+this.element.getHeight()+"px",left:this.element_position[0]+"px"});break;case"horizontal":this.popup_container.setStyle({top:this.window_height/2-this.popup_height/2+this.vertical_scroll+"px",left:this.element_position[0]+this.element.getWidth()+1+"px"})}},hidePopup:function(){this.removeIframe(),this.hideAllContainers(),this.overlay.setStyle({display:"none"}).stopObserving("click",this.overlay_observer),this.hideCallback(),window.currently_popped=null},hideAllContainers:function(){this.removeIframe(),this.overlay.select(".popup_container").each(function(a){a.style.display="none"},this)},attachCheckboxObserver:function(a,b,c){var d=this.layout_wrapper.down(a);if(d){var e=d.select('INPUT[type="checkbox"]');e.each(function(a){a.observe("click",this.toggleCheckboxDisabledPopup.bindAsEventListener(this,e,b,c))},this)}this.select_all=$("select-all"),this.deselect_all=$("deselect-all"),this.select_all&&this.deselect_all&&(this.select_all.observe("click",this.toggleDisabledPopup.bindAsEventListener(this,!0,b,c)),this.deselect_all.observe("click",this.toggleDisabledPopup.bindAsEventListener(this,!1,b,c))),e&&this.toggleCheckboxDisabledPopup(this,e,b,c)},toggleCheckboxDisabledPopup:function(a,b,c,d){var e=!1;b.each(function(a){a.checked&&(e=!0)}),e?this.toggleDisabledPopup(a,!0,c,d):this.toggleDisabledPopup(a,!1,c,d)},toggleDisabledPopup:function(a,b,c,d){var e=$(c);b?(e.removeClassName("disabled"),this.element.src=d[0]):(e.addClassName("disabled"),this.element.src=d[1])},displayUnlessDisabled:function(){this.element.hasClassName("disabled")&&(this.validated=!1)}});Popup.CONFIG={use_ajax:!0,position:"auto",window_submit_selector:".form-action",window_close_selector:".close-popup",layout_wrapper:"LayoutWrapper",dhtml_popup_class:"DHTMLPopup",dhtml_trigger_class:"DHTMLTrigger",initialize_callback:Prototype.emptyFunction,validate_callback:Prototype.emptyFunction,show_callback:Prototype.emptyFunction,hide_callback:Prototype.emptyFunction,form_onsuccess_callback:Prototype.emptyFunction,form_onfailure_callback:Prototype.emptyFunction,cancel_form_callback:Prototype.emptyFunction},Event.addBehavior({"#popup-choose-sources":Popup("choose-sources",{position:"vertical",use_ajax:!1}),"#popup-email-document":Popup("ajax/email_document.html",{position:"vertical"})});var RelatedContent=Class.create(PageWidget,{initialize:function(a,b,c){this.node=$(a),this.node&&b&&(this.setOptions(c),this.initializeListElements(b))},initializeListElements:function(a){this.reference_list=$(this.CONFIG.references_list),this.citation_list=$(this.CONFIG.citations_list),this.fetchReferencesAndCitations(a)},fetchReferencesAndCitations:function(a){new Ajax.Request(this.CONFIG.ajax_request,{method:"get",evalJSON:"force",parameters:a,onSuccess:this.fetchSuccessHandler.bind(this),onFailure:this.fetchFailureHandler.bind(this)})},fetchSuccessHandler:function(a){a.responseJSON.title&&a.responseJSON.references&&a.responseJSON.citations?(this.json_references=a.responseJSON.references,this.json_citations=a.responseJSON.citations,this.updatePageTitle(a.responseJSON.title),this.loadReferencesAndCitations(),this.initializeScrollArrows(),this.initializeItemHovering(),this.initializePopupObservers()):this.fetchFailureHandler()},updatePageTitle:function(a){var b=$(this.CONFIG.document_title);b&&b.update(a)},loadReferencesAndCitations:function(){for(x=0;x<this.json_references.length;x++)this.createListItem(this.json_references[x],this.reference_list,x);for(x=0;x<this.json_citations.length;x++)this.createListItem(this.json_citations[x],this.citation_list,x)},createListItem:function(a,b){var c=new Element("LI").update("<span>"+a.title+"</span");b.insert({bottom:c})},fetchFailureHandler:function(){this.node.up().setStyle({display:"none"})},initializeScrollArrows:function(){var a=$(this.CONFIG.references_up_arrow),b=$(this.CONFIG.references_down_arrow),c=$(this.CONFIG.citations_up_arrow),d=$(this.CONFIG.citations_down_arrow);this.json_references.length>5?(a.observe("mouseover",this.arrowMouseOverHandler.bindAsEventListener(this,a)),b.observe("mouseout",this.arrowMouseOutHandler.bindAsEventListener(this,b)),a.observe("click",this.scrollingClickHandler.bindAsEventListener(this,this.reference_list,!0)),b.observe("click",this.scrollingClickHandler.bindAsEventListener(this,this.reference_list,!1))):(a.addClassName("Disabled"),b.addClassName("Disabled")),this.json_citations.length>5?(c.observe("mouseover",this.arrowMouseOverHandler.bindAsEventListener(this,c)),d.observe("mouseout",this.arrowMouseOutHandler.bindAsEventListener(this,d)),c.observe("click",this.scrollingClickHandler.bindAsEventListener(this,this.citations_list,!0)),d.observe("click",this.scrollingClickHandler.bindAsEventListener(this,this.citations_list,!1))):(c.addClassName("Disabled"),d.addClassName("Disabled"))},arrowMouseOverHandler:function(a,b){var c=b.up().down("UL"),d=c.cumulativeScrollOffset()[1];b.id.endsWith("up")?0==d?b.removeClassName("Hovering"):b.addClassName("Hovering"):d==b.up().down("UL").getHeight()?b.removeClassName("Hovering"):b.addClassName("Hovering")},arrowMouseOutHandler:function(a,b){b.removeClassName("Hovering")},initializeItemHovering:function(){this.node.select("LI").each(function(a){a.observe("mouseover",function(){a.addClassName("Hover")}),a.observe("mouseout",function(){a.removeClassName("Hover")})})},scrollingClickHandler:function(a,b,c){c?this.scrollUp(b.up()):this.scrollDown(b.up())},scrollUp:function(a){var b=a.cumulativeScrollOffset()[1];0!=b&&(a.scrollTop=b-76)},scrollDown:function(a){var b=a.cumulativeScrollOffset()[1];b!=a.getHeight()&&(a.scrollTop=b+76)},initializePopupObservers:function(){this.node.select("LI SPAN").each(function(a){a.observe("click",this.fetchItemDetails.bindAsEventListener(this,a))},this)},fetchItemDetails:function(a,b){var c=b.up("UL").id,d=b.up("LI").previousSiblings().length,e=c==this.CONFIG.references_list?"right-details":"left-details",f=c==this.CONFIG.references_list?this.json_references[d]:this.json_citations[d];this.displayItemDetailPopup(f,e)},displayItemDetailPopup:function(a,b){this.hideDetailPopups();var c=new Element("DIV",{"class":"content-details "+b}),d=new Template('<img class="close-details" src="assets/img/btn.close.gif" alt="Close"/><h2><a href="#{data.url}">#{title}</a></h2><p class="detail">#{authors}</p><p class="detail"><a href="#{publication_url}">#{publication_title}</a>, Volume #{volume_number}, Issue #{issue_number}, #{publication_date} Page(s) #{page_numbers[0]}-#{page_numbers[1]}</p><h3><a href="#{free_preview_url}">Free Preview</a>&nbsp;|&nbsp;<a href="#{related_url}">Related</a>&nbsp;|&nbsp;<a href="#{citations_url}">Cited by #{citations_number}</a></h3><h4>Abstract</h4><p>#{abstract}</p>');c.update(d.evaluate(a)),this.node.insert({bottom:c}).down(".close-details").observe("click",this.hideDetailPopups.bindAsEventListener(this))},hideDetailPopups:function(){this.node.select(".content-details").invoke("remove")}});RelatedContent.CONFIG={ajax_request:"/ajax/related_content.json.php",document_title:"article-title",references_list:"references-list",references_up_arrow:"buttefly-references-up",references_down_arrow:"buttefly-references-down",citations_list:"citations-list",citations_up_arrow:"buttefly-citations-up",citations_down_arrow:"buttefly-citations-down"};var Revealer=Behavior.create(PageWidget,{initialize:function(a){this.setOptions(a),this.nodes={},this.nodes.controller=this.element.down(this.CONFIG.controller_class),this.nodes.content=this.element.down(this.CONFIG.content_class),this.nodes.controller&&this.nodes.content&&(this.CONFIG.hidden_by_default&&this.nodes.content.hide(),this.initializeCallback=this.CONFIG.initialize_callback.bind(this),this.controlCallback=this.CONFIG.control_callback.bind(this),this.nodes.controller.observe("click",this.revealerControlClickHandler.bindAsEventListener(this)),this.initializeCallback())},revealerControlClickHandler:function(){this.revealOrConcealContent(),this.controlCallback()},revealOrConcealContent:function(){this.CONFIG.effect?new Effect.toggle(this.nodes.content,"blind",this.CONFIG.effect_options):this.nodes.content.toggle()}});Revealer.CONFIG={controller_class:".RevealControl",content_class:".RevealContent",effect:!1,effect_options:{duration:1},hidden_by_default:!0,initialize_callback:Prototype.emptyFunction,control_callback:Prototype.emptyFunction},Event.addBehavior({"UL.Results LI":Revealer({effect:!0,hidden_by_default:!0,initialize_callback:function(){this.nodes.controller.writeAttribute("title","Click to Reveal")},control_callback:function(){this.nodes.controller.src=this.nodes.content.visible()?"assets/img/btn.quick-abstract.collapsed.gif":"assets/img/btn.quick-abstract.expanded.gif",this.nodes.controller.title=this.nodes.content.visible()?"Click to Reveal":"Click to Close"}}),"UL.Browsing LI":Revealer({effect:!0,hidden_by_default:!0,initialize_callback:function(){this.nodes.controller.writeAttribute("title","Click to Reveal")},control_callback:function(){this.nodes.controller.src=this.nodes.content.visible()?"assets/img/btn.view-details.collapsed.gif":"assets/img/btn.view-details.expanded.gif",this.nodes.controller.up(".header").toggleClassName("open"),this.nodes.controller.title=this.nodes.content.visible()?"Click to Reveal":"Click to Close"}}),"DIV.advanced-search .DHTML":Revealer({effect:!0,hidden_by_default:!0,initialize_callback:function(){this.nodes.controller.addClassName("link"),this.nodes.controller.writeAttribute("title","Click to Reveal")},control_callback:function(){this.nodes.controller.up(".header").toggleClassName("open"),this.nodes.controller.title=this.nodes.content.visible()?"Click to Reveal":"Click to Close"}}),"DIV.column-side-left DIV.box .DHTML":Revealer({effect:!0,hidden_by_default:!0,initialize_callback:function(){this.nodes.controller.addClassName("link"),this.nodes.controller.writeAttribute("title","Click to Reveal")},control_callback:function(){this.nodes.controller.toggleClassName("open"),this.nodes.controller.title=this.nodes.content.visible()?"Click to Reveal":"Click to Close"}})});var SelectAll=Behavior.create(PageWidget,{initialize:function(a,b){this.setOptions(b),this.checkbox_nodes=this.element.select('input[type="checkbox"]'),this.controls_container=$(a),this.checkbox_nodes.size()<1||!this.controls_container||(this.select_all_node=this.controls_container.down("."+this.CONFIG.select_class),this.deselect_all_node=this.controls_container.down("."+this.CONFIG.deselect_class),this.select_all_node&&this.deselect_all_node&&(this.select_all_node.observe("click",this.toggleAllSelections.bindAsEventListener(this,"checked")),this.deselect_all_node.observe("click",this.toggleAllSelections.bindAsEventListener(this,"")),this.controls_container.setStyle({display:"block"})))},toggleAllSelections:function(a,b){this.checkbox_nodes.each(function(a){a.checked=b})}});SelectAll.CONFIG={select_class:"SelectAll",deselect_class:"DeSelectAll"},Event.addBehavior({"UL.Results":SelectAll("toggle-all-checkboxes"),"UL.listview":SelectAll("toggle-all-checkboxes")});var SelectObserver=Behavior.create({initialize:function(){this.select_fieldset=this.element.up("FIELDSET"),this.select_form=this.select_fieldset.up("FORM"),this.select_fieldset&&this.select_form&&(this.select_fieldset.down("INPUT").setStyle({display:"none"}),this.element.observe("change",this.selectChangeHandler.bindAsEventListener(this)))},selectChangeHandler:function(){this.select_form.submit()}});Event.addBehavior({"#search-results-sort-by":SelectObserver});var TabSet=Behavior.create(PageWidget,{initialize:function(a){if(this.setOptions(a),!this.element.hasClassName(this.CONFIG.static_class)){this.tabs=[],this.element.select(this.CONFIG.tab_selector).each(function(a){this.tabs.push(new TabSet.Tab(a,this))},this);var b,c=window.location.hash.substring(1);c.blank()||(b=this.tabs.find(function(a){return a.element.href.getHash()==c})||this.tabs[0]),b||(b=this.tabs.find(function(a){return a.element.up().hasClassName("Active")})||this.tabs[0]),b.activate(!0),this.initializeCallback=this.CONFIG.initialize_callback,this.initializeCallback()}}});TabSet.CONFIG={tab_selector:".TabNav A",tab_prefix:"tab_",active_class:"Active",static_class:"Static",initialize_callback:Prototype.emptyFunction},TabSet.Tab=Class.create({initialize:function(a,b){this.element=$(a),this.tab_set=b,this.node_target_id=this.element.href.getHash(),this.nav_node=this.element.up(),this.tab_node=$(this.tab_set.CONFIG.tab_prefix+this.node_target_id),a.observe("click",this.handleAnchorClick.bindAsEventListener(this))},handleAnchorClick:function(a){a.stop(),a.element().blur(),this.activate()},activate:function(a){var b=this.tab_set.CONFIG.active_class;(!this.nav_node.hasClassName(b)||a)&&this.tab_set.tabs.each(function(a){this.node_target_id==a.node_target_id?(a.nav_node.addClassName(b),a.tab_node.addClassName(b),a.tab_node.show()):(a.nav_node.removeClassName(b),a.tab_node.removeClassName(b),a.tab_node.hide())},this)}}),Event.addBehavior({".tabbed-content":TabSet({tab_selector:".tab-menu LI A",tab_prefix:"",active_class:"selected"}),"#highlights":TabSet({tab_selector:".pagination LI A",tab_prefix:"",active_class:"selected",initialize_callback:function(){var a=this.element.down(".footer");a&&a.setStyle({display:"block"})}})});var Tooltip=Behavior.create(PageWidget,{initialize:function(a){this.setOptions(a),this.position=this.CONFIG.position,this.createTooltip(),this.getElementWidth(),this.element.observe("mouseover",this.mouseOverHandler.bindAsEventListener(this)),this.element.observe("mouseout",this.mouseOutHandler.bindAsEventListener(this))},createTooltip:function(){this.tooltip_wrapper=new Element("DIV",{"class":this.CONFIG.tooltip_wrapper_class}),this.tooltip=new Element("DIV",{"class":this.CONFIG.tooltip_class}).update(new Element("DIV",{"class":"BoxFix"}).update(this.CONFIG.tooltip_contents)),this.tooltip_wrapper.update(this.tooltip),this.tooltip_arrow=new Element("DIV",{"class":this.CONFIG.tooltip_arrow_class}),this.tooltip_wrapper.insert({bottom:this.tooltip_arrow}),this.element.insert({after:this.tooltip_wrapper}),this.calculateTooltipHeight()},createIframe:function(a){this.iframe=new Template('<iframe id="#{id}" frameborder="0" scrolling="no" style="position: relative; top: -#{top}; z-index: -999; width: #{width}; height: #{height}; left: #{left};"></iframe>').evaluate(a)},getElementWidth:function(){if(0==this.element.clientWidth){var a=this.element.ancestors().find(function(a){return a.clientWidth>0},this);this.element_width=a.clientWidth}else this.element_width=this.element.clientWidth},mouseOverHandler:function(){clearTimeout(this.tooltip_hide_timeout),clearTimeout(this.tooltip_show_timeout),this.prepareTooltip(),this.menu_show_timeout=setTimeout(this.showTooltip.bind(this),this.CONFIG.tooltip_show_time)},mouseOutHandler:function(){clearTimeout(this.tooltip_hide_timeout),clearTimeout(this.tooltip_show_timeout),this.tooltip_hide_timeout=setTimeout(this.hideTooltip.bind(this),this.CONFIG.tooltip_hide_time)},prepareTooltip:function(){this.calculateTooltipPosition(),this.positionTooltip(),this.tooltip_wrapper.addClassName(this.CONFIG.tooltip_active_class)},calculateTooltipHeight:function(){this.tooltip_wrapper.setStyle({display:"block",position:"absolute",top:"-9999px"}),this.tooltip_height=this.tooltip_wrapper.getHeight()+30,Prototype.Browser.IE6&&(this.iframe_id="tooltip-"+Math.floor(1e3*Math.random()),this.createIframe({id:this.iframe_id,top:this.tooltip.offsetHeight+"px",left:this.tooltip.offsetLeft+1+"px",height:this.tooltip.offsetHeight+"px",width:this.tooltip.offsetWidth-6+"px"})),this.tooltip_wrapper.removeAttribute("style")},calculateTooltipPosition:function(){this.coords=this.element.positionedOffset();var a=document.viewport.getWidth(),b=this.coords[1]-document.viewport.getScrollOffsets()[1];if(this.coords[0]+170>a&&(this.position="left",this.coords[1]-parseInt(this.left_alignment)<150)){var c=!0;this.left_alignment=parseInt(this.left_alignment)-this.element_width+"px"}this.left_alignment="left"==this.position?this.coords[0]-this.element_width+"px":this.coords[0]+this.element_width/2+"px",c&&(this.left_alignment=parseInt(this.left_alignment)-this.element_width+"px"),b<this.tooltip_height+30?(this.classname="left"==this.position?this.CONFIG.tooltip_top_right_class:this.CONFIG.tooltip_top_left_class,this.vertical_alignment=this.coords[1]+(2*this.element.clientHeight+6)+"px"):(this.classname="left"==this.position?this.CONFIG.tooltip_bottom_right_class:this.CONFIG.tooltip_bottom_left_class,this.vertical_alignment=this.coords[1]-this.tooltip_height+12+"px")},positionTooltip:function(){this.resetTooltip(),this.calculateTooltipPosition(),parseInt(this.left_alignment)<0&&(this.left_alignment=-1*this.left_alignment),this.tooltip_wrapper.setStyle({left:this.left_alignment,top:this.vertical_alignment}),this.tooltip_wrapper.addClassName(this.classname)},resetTooltip:function(){this.tooltip_wrapper.removeClassName(this.CONFIG.tooltip_bottom_left_class).removeClassName(this.CONFIG.tooltip_bottom_right_class).removeClassName(this.CONFIG.tooltip_top_right_class).removeClassName(this.CONFIG.tooltip_top_left_class).removeAttribute("style"),this.tooltip_arrow.removeAttribute("style")},showTooltip:function(){Prototype.Browser.IE6&&this.showIframe(),this.tooltip_wrapper.addClassName(this.CONFIG.tooltip_active_class)},hideTooltip:function(){Prototype.Browser.IE6&&this.hideIframe(),this.tooltip_wrapper.removeClassName(this.CONFIG.tooltip_active_class)},showIframe:function(){$(this.iframe_id)||new Insertion.Bottom(this.tooltip_wrapper,this.iframe)},hideIframe:function(){var a=$(this.iframe_id);a&&a.remove()}});Tooltip.CONFIG={contents:"",position:"left",tooltip_class:"Tip",tooltip_wrapper_class:"TipWrapper",tooltip_active_class:"ActiveToolTip",tooltip_anchor_class:"TipAnchor",tooltip_arrow_class:"ToolTipArrow",tooltip_top_right_class:"TopRightTooltip",tooltip_top_left_class:"TopLeftTooltip",tooltip_bottom_right_class:"BottomRightTooltip",tooltip_bottom_left_class:"BottomLeftTooltip",tooltip_show_time:25,tooltip_hide_time:50,tooltip_contents:""},Event.addBehavior({".Tooltip":Tooltip({position:"right",tooltip_contents:"<p>An example of a simple tooltip.</p>"}),".LeftTooltip":Tooltip({position:"left",tooltip_contents:"<p>An example of a simple tooltip.</p>"}),".Bluetip":Tooltip({position:"left",tooltip_contents:"<p>This tooltip is <strong>blue</strong>!<br />And awesome.<br />And...</p>",tooltip_wrapper_class:"BlueTipWrapper"})});